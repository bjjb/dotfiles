#!/bin/bash
# Create webm files from avi files (or any file, really).

# Encode to webm (vp9, opus) at $BV (default 1M).
# Overwrite files if needed. Delete the original file if successful.

cv=${CV:-libvpx-vp9}
bv=${BV:-1M}
ca=${CA:-libopus}
ba=${BA:-24k}

convert() {
  i=${1?No input file given}
  o="${1%.*}.webm"

  ffmpeg -i "$i" -c:v $cv -b:v $bv -c:a $ca -b:a $ba -y "$o" \
      && rm "$i"
}

for f in $@
do
  convert $f
done
